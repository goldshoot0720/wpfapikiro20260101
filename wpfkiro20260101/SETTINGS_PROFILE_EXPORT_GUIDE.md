# 設定檔匯出功能完整指南

## 🎯 功能概述

我們已經為你的 WPF 應用程式實現了完整的設定檔匯出功能，並確保編輯設定檔時與連線設定保持一致性。

## 📤 匯出功能

### 1. 快速匯出（推薦）
- **位置**：設定頁面 → 「📤 快速匯出」按鈕
- **功能**：一鍵匯出所有設定檔到桌面
- **檔名格式**：`設定檔備份_yyyyMMdd_HHmmss.json`
- **特色**：
  - 自動保存到桌面
  - 包含時間戳記避免檔名衝突
  - 匯出完成後可選擇開啟檔案位置

### 2. 管理匯出
- **位置**：設定頁面 → 「📁 管理設定檔」→ 設定檔管理視窗
- **功能選項**：
  - 「📤 匯出設定檔」：匯出全部設定檔
  - 「📤 匯出選中」：匯出特定設定檔
  - 「⚡ 快速匯出全部」：快速匯出到桌面

### 3. 測試功能
- **位置**：設定頁面 → 「🧪 測試匯出」按鈕
- **功能**：驗證匯出功能是否正常運作
- **包含**：自動測試、使用指南顯示

## ✏️ 編輯一致性功能

### 新的編輯對話框
我們創建了全新的 `EditProfileDialog`，提供以下功能：

#### 🔄 自動同步功能
- **「與當前連線設定保持同步」**選項
- 切換後端服務時自動載入對應設定
- 「載入當前設定」按鈕手動同步

#### 🎛️ 智能欄位顯示
- 根據選擇的後端服務動態顯示相關欄位
- Appwrite：顯示 Database ID、Bucket ID 等專用欄位
- 其他服務：隱藏不相關欄位，簡化界面

#### ✅ 一致性檢查
- 編輯完成後自動檢測是否與當前連線設定相似
- 提示用戶是否重新載入設定檔以保持一致性
- 避免設定不同步的問題

## 🗂️ 檔案結構

### 新增的檔案
```
wpfkiro20260101/
├── EditProfileDialog.xaml          # 新的編輯對話框界面
├── EditProfileDialog.xaml.cs       # 編輯對話框邏輯
├── TestProfileExport.cs             # 匯出功能測試類別
└── SETTINGS_PROFILE_EXPORT_GUIDE.md # 本指南文檔
```

### 修改的檔案
```
wpfkiro20260101/
├── SettingsPage.xaml               # 添加快速匯出和測試按鈕
├── SettingsPage.xaml.cs            # 實現快速匯出功能
├── SettingsProfileWindow.xaml      # 添加快速匯出按鈕
└── SettingsProfileWindow.xaml.cs   # 更新編輯功能使用新對話框
```

## 🚀 使用方法

### 匯出設定檔
1. **快速匯出**：
   ```
   設定頁面 → 點擊「📤 快速匯出」→ 確認開啟檔案位置
   ```

2. **選擇性匯出**：
   ```
   設定頁面 → 「📁 管理設定檔」→ 選擇設定檔 → 「📤 匯出選中」
   ```

### 編輯設定檔並保持一致性
1. **開啟編輯**：
   ```
   管理設定檔 → 選擇設定檔 → 「✏️ 編輯設定檔」
   ```

2. **保持同步**：
   - 勾選「與當前連線設定保持同步」
   - 切換後端服務時自動載入對應設定
   - 或點擊「載入當前設定」手動同步

3. **完成編輯**：
   - 點擊「儲存」
   - 如果與當前設定相似，系統會詢問是否重新載入

## 🔧 技術特色

### 1. 智能同步機制
- 自動檢測當前連線設定
- 根據後端服務類型載入對應設定
- 編輯完成後提供一致性檢查

### 2. 用戶體驗優化
- 一鍵快速匯出到桌面
- 自動生成帶時間戳記的檔名
- 匯出完成後可直接開啟檔案位置

### 3. 錯誤處理
- 完整的異常處理機制
- 用戶友好的錯誤訊息
- 操作狀態即時反饋

### 4. 測試支援
- 內建測試功能驗證匯出
- 自動創建測試設定檔
- 詳細的調試輸出

## 📋 JSON 格式說明

匯出的 JSON 檔案包含以下資訊：
```json
[
  {
    "Id": "設定檔唯一識別碼",
    "ProfileName": "設定檔名稱",
    "Description": "設定檔描述",
    "BackendService": 0,  // 後端服務類型（數字）
    "ApiUrl": "API 網址",
    "ProjectId": "專案 ID",
    "ApiKey": "API 金鑰",
    "DatabaseId": "資料庫 ID（Appwrite 專用）",
    "BucketId": "儲存桶 ID（Appwrite 專用）",
    "FoodCollectionId": "食品集合 ID",
    "SubscriptionCollectionId": "訂閱集合 ID",
    "CreatedAt": "創建時間",
    "UpdatedAt": "更新時間"
  }
]
```

## 🎯 使用建議

### 定期備份
- 建議定期使用快速匯出功能備份設定檔
- 重要設定變更前先匯出備份

### 編輯最佳實踐
- 編輯設定檔時建議勾選「與當前連線設定保持同步」
- 編輯完成後注意一致性提示，必要時重新載入設定檔

### 測試驗證
- 使用「🧪 測試匯出」功能驗證匯出是否正常
- 查看調試輸出了解詳細測試結果

## 🔍 故障排除

### 匯出失敗
- 檢查磁碟空間是否充足
- 確認對桌面有寫入權限
- 檢查防毒軟體是否阻擋檔案寫入

### 編輯問題
- 如果編輯對話框無法開啟，會自動使用簡化版本
- 設定不同步時，手動點擊「載入當前設定」

### 一致性問題
- 編輯完成後注意系統提示
- 必要時重新載入設定檔以保持一致性

---

## 🎉 總結

現在你的應用程式具備了完整的設定檔匯出功能，並且編輯設定檔時能夠與連線設定保持一致性。這些功能將大大提升用戶體驗，讓設定管理更加便利和可靠。